name: 'README Bot'
description: 'AI-powered README maintenance tool that suggests updates based on PR changes'
author: 'README Bot'

branding:
  icon: 'book-open'
  color: 'blue'

inputs:
  anthropic-api-key:
    description: 'Anthropic Claude API key'
    required: true
  
  format:
    description: 'Output format (github, cli, json)'
    required: false
    default: 'github'
  
  post-comment:
    description: 'Whether to post suggestions as PR comment'
    required: false
    default: 'true'
  
  update-existing:
    description: 'Update existing README-Bot comment instead of creating new ones'
    required: false
    default: 'true'
  
  config-path:
    description: 'Path to custom configuration file'
    required: false
  
  verbose:
    description: 'Enable verbose output'
    required: false
    default: 'false'

outputs:
  needs-update:
    description: 'Whether README needs updates (true/false/unknown)'
  
  suggestion-count:
    description: 'Number of suggestions generated'
  
  comment-url:
    description: 'URL of the posted comment (if applicable)'
  
  error:
    description: 'Error message if analysis failed'

runs:
  using: 'composite'
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Cache npm dependencies
      uses: actions/cache@v4
      id: cache-deps
      with:
        path: ${{ github.action_path }}/node_modules
        key: ${{ runner.os }}-npm-${{ hashFiles('${{ github.action_path }}/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-npm-
    
    - name: Install dependencies
      if: steps.cache-deps.outputs.cache-hit != 'true'
      run: npm ci
      shell: bash
      working-directory: ${{ github.action_path }}
    
    - name: Run README Bot
      run: node src/index.js action --format ${{ inputs.format }} ${{ inputs.verbose == 'true' && '--verbose' || '' }}
      shell: bash
      working-directory: ${{ github.action_path }}
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}
        GH_CLIENT_ID: ${{ secrets.GH_CLIENT_ID }}
        GH_CLIENT_SECRET: ${{ secrets.GH_CLIENT_SECRET }}
        ANTHROPIC_API_KEY: ${{ inputs.anthropic-api-key }}
        README_BOT_CONFIG_PATH: ${{ inputs.config-path }}